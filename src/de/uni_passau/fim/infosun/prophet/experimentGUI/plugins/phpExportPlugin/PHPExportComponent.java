package de.uni_passau.fim.infosun.prophet.experimentGUI.plugins.phpExportPlugin;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import javax.swing.BorderFactory;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPasswordField;
import javax.swing.JTextField;

import de.uni_passau.fim.infosun.prophet.experimentGUI.util.VerticalLayout;
import de.uni_passau.fim.infosun.prophet.experimentGUI.util.language.UIElementNames;
import de.uni_passau.fim.infosun.prophet.experimentGUI.util.settingsComponents.SettingsComponent;
import sun.misc.BASE64Decoder;

public class PHPExportComponent extends SettingsComponent {

    private static final long serialVersionUID = 1L;

    private static final String index =
            "PD9waHAJDQoJcmVxdWlyZV9vbmNlKCdjb25maWcucGhwJyk7DQoJcmVxdWlyZV9vbmNlKCdjb25zdGFudHMucGhwJyk7CQ0KCQ0KCWhlYWRlcigiQ29udGVudC1UeXBlOiB0ZXh0L2h0bWw7IGNoYXJzZXQ9VVRGLTgiKTsNCg0KCWVjaG8gSFRNTF9TVEFSVDsNCgkNCglmdW5jdGlvbiBteUVuZCgkZXJyb3IgPSAiIikgew0KCQlpZiAoJGVycm9yKSB7DQoJCQllY2hvICI8cD5FcnJvcjogJGVycm9yPC9wPiI7DQoJCX0NCgkJZWNobyBIVE1MX0VORDsNCgkJZGllKCk7DQoJfQ0KCQ0KCWZ1bmN0aW9uIG15U3RyaXBTbGFzaGVzKCRzdHJpbmcpIHsNCgkJaWYgKGdldF9tYWdpY19xdW90ZXNfZ3BjKCkpIHsNCgkJCXJldHVybiBzdHJpcHNsYXNoZXMoJHN0cmluZyk7DQoJCX0NCgkJcmV0dXJuICRzdHJpbmc7DQoJfQ0KCWZ1bmN0aW9uIG15QWRkU2xhc2hlcygkc3RyaW5nKSB7DQoJCXJldHVybiBteXNxbF9yZWFsX2VzY2FwZV9zdHJpbmcoJHN0cmluZyk7DQoJfQ0KCWZ1bmN0aW9uIG15U2xhc2hlcygkc3RyaW5nKSB7DQoJCXJldHVybiBteUFkZFNsYXNoZXMobXlTdHJpcFNsYXNoZXMoJHN0cmluZykpOw0KCX0NCgkNCglmdW5jdGlvbiBnZXROZXh0Tm9kZXMoJGV4cGVyaW1lbnQsJGNhdGVnb3J5LCRxdWVzdGlvbikgew0KCS8vUmVxdWVzdCBmb3IgbmV4dCBub24taW5hY3RpdmUsIG5vbi1kb25vdHNob3djb250ZW50IHF1ZXN0aW9ucyBhbmQgY2F0ZWdvcmllcyBpbiBhbnkgbm9uLWluYWN0aXZlIGNhdGVnb3J5DQoJJHJlcXVlc3QgPSA8PDxTUUxfUkVRVUVTVA0KU0VMRUNUIG5vZGVzLmV4cGVyaW1lbnQsIG5vZGVzLmNhdGVnb3J5LCBub2Rlcy5xdWVzdGlvbg0KRlJPTSBub2Rlcw0KSk9JTiAoDQoJU0VMRUNUIGNhdC5leHBlcmltZW50LCBjYXQuY2F0ZWdvcnkNCglGUk9NIG5vZGVzIGNhdA0KCUxFRlQgSk9JTiBub2Rlc19hdHRyaWJ1dGVzIGNhdGF0dHIgT04gY2F0LmV4cGVyaW1lbnQgPSBjYXRhdHRyLmV4cGVyaW1lbnQNCglBTkQgY2F0LmNhdGVnb3J5ID0gY2F0YXR0ci5jYXRlZ29yeQ0KCUFORCBjYXQucXVlc3Rpb24gPSBjYXRhdHRyLnF1ZXN0aW9uDQoJQU5EIGNhdGF0dHIubmFtZSA9ICJpbmFjdGl2ZSINCglXSEVSRSBjYXQucXVlc3Rpb24gPTANCglBTkQgKA0KCQljYXRhdHRyLnZhbHVlIElTIE5VTEwNCgkJT1IgY2F0YXR0ci52YWx1ZSA9MA0KCSkNCiljYXRfbm90X2luYWN0aXZlIE9OIG5vZGVzLmV4cGVyaW1lbnQgPSBjYXRfbm90X2luYWN0aXZlLmV4cGVyaW1lbnQNCkFORCBub2Rlcy5jYXRlZ29yeSA9IGNhdF9ub3RfaW5hY3RpdmUuY2F0ZWdvcnkNCkxFRlQgSk9JTiBub2Rlc19hdHRyaWJ1dGVzIGF0dHIgT04gbm9kZXMuZXhwZXJpbWVudCA9IGF0dHIuZXhwZXJpbWVudA0KQU5EIG5vZGVzLmNhdGVnb3J5ID0gYXR0ci5jYXRlZ29yeQ0KQU5EIG5vZGVzLnF1ZXN0aW9uID0gYXR0ci5xdWVzdGlvbg0KQU5EIGF0dHIubmFtZSA9ICJpbmFjdGl2ZSINCkxFRlQgSk9JTiBub2Rlc19hdHRyaWJ1dGVzIGF0dHIyIE9OIG5vZGVzLmV4cGVyaW1lbnQgPSBhdHRyMi5leHBlcmltZW50DQpBTkQgbm9kZXMuY2F0ZWdvcnkgPSBhdHRyMi5jYXRlZ29yeQ0KQU5EIG5vZGVzLnF1ZXN0aW9uID0gYXR0cjIucXVlc3Rpb24NCkFORCBhdHRyMi5uYW1lID0gImRvbm90c2hvd2NvbnRlbnQiDQpXSEVSRSBub2Rlcy5leHBlcmltZW50ID0kZXhwZXJpbWVudA0KQU5EICgNCgkoDQoJCW5vZGVzLmNhdGVnb3J5ID0kY2F0ZWdvcnkNCgkJQU5EIG5vZGVzLnF1ZXN0aW9uID4kcXVlc3Rpb24NCgkpDQoJT1Igbm9kZXMuY2F0ZWdvcnkgPiRjYXRlZ29yeQ0KKQ0KQU5EICgNCglhdHRyLnZhbHVlIElTIE5VTEwNCglPUiBhdHRyLnZhbHVlID0wDQopDQpBTkQgKA0KCWF0dHIyLnZhbHVlIElTIE5VTEwNCglPUiBhdHRyMi52YWx1ZSA9MA0KKQ0KT1JERVIgQlkgbm9kZXMuZXhwZXJpbWVudCBBU0MgLCBub2Rlcy5jYXRlZ29yeSBBU0MgLCBub2Rlcy5xdWVzdGlvbiBBU0MNClNRTF9SRVFVRVNUOw0KCQkkcmVzdWx0ID0gbXlzcWxfcXVlcnkoJHJlcXVlc3QpDQoJCQlvciBteUVuZCgnQ2Fubm90IHJldHJpZXZlIG5leHQgbm9kZTogJyAuIG15c3FsX2Vycm9yKCkpOw0KCQl3aGlsZSAoJGxpbmUgPSBteXNxbF9mZXRjaF9hcnJheSgkcmVzdWx0KSkgew0KCQkJJGxpbmVzW10gPSAkbGluZTsNCgkJfQ0KCQlyZXR1cm4gJGxpbmVzOw0KCX0NCgkNCglpZiAoJF9SRVFVRVNUW0tFWV9FWFBFUklNRU5UX0NPREVdKSB7DQoJCS8vZWNobyAiREVCVUc6IFJlY2VpdmVkIGV4cGVyaW1lbnQgY29kZSI7DQoJCSRleHBlcmltZW50X2NvZGUgPSBteVNsYXNoZXMoJF9SRVFVRVNUW0tFWV9FWFBFUklNRU5UX0NPREVdKTsNCgkJDQoJCS8vU2hvdyBleHBlcmltZW50IHN0YXJ0IHBhZ2UNCgkJJHJlc3VsdCA9IG15c3FsX3F1ZXJ5KCJTRUxFQ1QgZXhwZXJpbWVudCBGUk9NIGV4cGVyaW1lbnRzIFdIRVJFIGNvZGU9XCIkZXhwZXJpbWVudF9jb2RlXCIiKQ0KCQkJb3IgbXlFbmQoJ0Nhbm5vdCByZXRyaWV2ZSBleHBlcmltZW50OiAnIC4gbXlzcWxfZXJyb3IoKSk7DQoJCSRleHBlcmltZW50X3Jvdz1teXNxbF9mZXRjaF9yb3coJHJlc3VsdCk7DQoJCWlmICghJGV4cGVyaW1lbnRfcm93KSB7DQoJCQlteUVuZCgnRXhwZXJpbWVudCBub3QgZm91bmQuJyk7DQoJCX0NCgkJJGV4cGVyaW1lbnQ9JGV4cGVyaW1lbnRfcm93WzBdOw0KCQkkY2F0ZWdvcnk9MDsNCgkJJHF1ZXN0aW9uPTA7DQoJCSRzaG93Tm9kZT0xOw0KCX0NCglpZihpc19udW1lcmljKCRfUE9TVFtLRVlfRVhQRVJJTUVOVF0pICYmIGlzX251bWVyaWMoJF9QT1NUW0tFWV9DQVRFR09SWV0pICYmIGlzX251bWVyaWMoJF9QT1NUW0tFWV9RVUVTVElPTl0pKSB7DQoJCSRleHBlcmltZW50PW15U2xhc2hlcygkX1BPU1RbS0VZX0VYUEVSSU1FTlRdKTsNCgkJJGNhdGVnb3J5PW15U2xhc2hlcygkX1BPU1RbS0VZX0NBVEVHT1JZXSk7DQoJCSRxdWVzdGlvbj1teVNsYXNoZXMoJF9QT1NUW0tFWV9RVUVTVElPTl0pOwkJDQoJCS8vZWNobyAiREVCVUc6IFJlY2VpdmVkIG5vZGUgY29kZXM6ICRleHBlcmltZW50LCRjYXRlZ29yeSwkcXVlc3Rpb24iOw0KCQkkdGltZXVzZWQ9bXlBZGRTbGFzaGVzKG1pY3JvdGltZSh0cnVlKS1teVN0cmlwU2xhc2hlcygkX1BPU1RbS0VZX1RJTUVdKSk7DQoJCQ0KCQkkcmVzdWx0ID0gbXlzcWxfcXVlcnkoIlNFTEVDVCAqIEZST00gZXhwZXJpbWVudHMgV0hFUkUgZXhwZXJpbWVudD1cIiRleHBlcmltZW50XCIiKQ0KCQkJb3IgbXlFbmQoJ0Nhbm5vdCByZXRyaWV2ZSBleHBlcmltZW50OiAnIC4gbXlzcWxfZXJyb3IoKSk7DQoJCSRleHBlcmltZW50X3Jvdz1teXNxbF9mZXRjaF9yb3coJHJlc3VsdCk7DQoJCWlmICghJGV4cGVyaW1lbnRfcm93KSB7DQoJCQlteUVuZCgnRXhwZXJpbWVudCBub3QgZm91bmQuJyk7DQoJCX0NCgkJDQoJCS8vcmVhZCBhbmQgc2F2ZSB2YWx1ZXMNCgkJaWYgKCRfUE9TVFtLRVlfU1VCSkVDVF0pIHsNCgkJCS8vc3ViamVjdCBpZCBleGlzdHMNCgkJCS8vZWNobyAiREVCVUc6IFJlY2VpdmVkIHN1YmplY3QiOw0KCQkJJHN1YmplY3Q9bXlTbGFzaGVzKCRfUE9TVFtLRVlfU1VCSkVDVF0pOw0KCQl9IGVsc2Ugew0KCQkJLy9jcmVhdGUgc3ViamVjdA0KCQkJaWYgKCRfUE9TVFtLRVlfU1VCSkVDVF9DT0RFXSkgew0KCQkJCS8vZWNobyAiREVCVUc6IENyZWF0aW5nIHN1YmplY3QiOwkJCQ0KCQkJCS8vQ3JlYXRlIHN1YmplY3QgaW4gZGF0YWJhc2UNCgkJCQkkc3ViamVjdF9jb2RlID0gbXlTbGFzaGVzKCRfUE9TVFtLRVlfU1VCSkVDVF9DT0RFXSk7DQoJCQkJJHJlc3VsdCA9IG15c3FsX3F1ZXJ5KCJTRUxFQ1Qgc3ViamVjdCBGUk9NIHN1YmplY3RzIFdIRVJFIGV4cGVyaW1lbnQ9XCIkZXhwZXJpbWVudFwiIEFORCBjb2RlPVwiJHN1YmplY3RfY29kZVwiIikNCgkJCQkJb3IgbXlFbmQoJ0Nhbm5vdCByZXRyaWV2ZSBzdWJqZWN0OiAnIC4gbXlzcWxfZXJyb3IoKSk7DQoJCQkJJHN1YmplY3Rfcm93PW15c3FsX2ZldGNoX3JvdygkcmVzdWx0KTsNCgkJCQlpZiAoJHN1YmplY3Rfcm93KSB7DQoJCQkJCWVjaG8gIjxwPjxiPkEgc3ViamVjdCB3aXRoIHRoaXMgY29kZSBhbHJlYWR5IGV4aXN0cy48L2I+PC9wPiI7DQoJCQkJfSBlbHNlIHsNCgkJCQkJbXlzcWxfcXVlcnkoIklOU0VSVCBJTlRPIHN1YmplY3RzIChleHBlcmltZW50LGNvZGUpIFZBTFVFUyAoXCIkZXhwZXJpbWVudFwiLFwiJHN1YmplY3RfY29kZVwiKSIpDQoJCQkJCQlvciBteUVuZCgnQ2Fubm90IGNyZWF0ZSBzdWJqZWN0OiAnIC4gbXlzcWxfZXJyb3IoKSk7DQoJCQkJCSRzdWJqZWN0ID0gbXlzcWxfaW5zZXJ0X2lkKCk7DQoJCQkJfQ0KCQkJfSBlbHNlIHsNCgkJCQllY2hvICI8cD48Yj5QbGVhc2UgZW50ZXIgYSBzdWJqZWN0IGNvZGUuPC9iPjwvcD4iOw0KCQkJfQ0KCQl9DQoJCWlmKCEkc3ViamVjdCkgew0KCQkJLy9IYXBwZW5zIGlmIHN1YmplY3QgZmFpbHMgdG8gZW50ZXIgbmV3IGFuZCB2YWxpZCBzdWJqZWN0IGNvZGUNCgkJCS8vZWNobyAiREVCVUc6IERvIG5vdCBoYXZlIHN1YmplY3QgaWQiOw0KCQkJJGNhdGVnb3J5PTA7DQoJCQkkcXVlc3Rpb249MDsNCgkJCSRzaG93Tm9kZT0xOw0KCQl9IGVsc2Ugew0KCQkJLy9Xcml0ZSBhbnN3ZXJzIGlmIHRoZXkgZG9uJ3QgeWV0IGV4aXN0DQoJCQkvL2VjaG8gIkRFQlVHOiBXcml0aW5nIGFuc3dlcnMiOw0KCQkJJHJlc3VsdCA9IG15c3FsX3F1ZXJ5KCJTRUxFQ1QgKiBGUk9NIG5vZGVzIFdIRVJFIGV4cGVyaW1lbnQ9XCIkZXhwZXJpbWVudFwiIEFORCBjYXRlZ29yeT1cIiRjYXRlZ29yeVwiIEFORCBxdWVzdGlvbj1cIiRxdWVzdGlvblwiIikNCgkJCQlvciBteUVuZCgnQ2Fubm90IHJldHJpZXZlIG5vZGU6ICcgLiBteXNxbF9lcnJvcigpKTsNCgkJCSRleHBlcmltZW50X3Jvdz1teXNxbF9mZXRjaF9yb3coJHJlc3VsdCk7DQoJCQlpZiAoISRleHBlcmltZW50X3Jvdykgew0KCQkJCW15RW5kKCdOb2RlIG5vdCBmb3VuZC4nKTsNCgkJCX0NCgkJDQoJCQkkcmVzdWx0ID0gbXlzcWxfcXVlcnkoIlNFTEVDVCAqIEZST00gYW5zd2VycyBXSEVSRSBleHBlcmltZW50PVwiJGV4cGVyaW1lbnRcIiBBTkQgY2F0ZWdvcnk9XCIkY2F0ZWdvcnlcIiBBTkQgcXVlc3Rpb249XCIkcXVlc3Rpb25cIiBBTkQgc3ViamVjdD1cIiRzdWJqZWN0XCIiKQ0KCQkJCW9yIG15RW5kKCdDYW5ub3QgcmV0cmlldmUgYW5zd2VyczogJyAuIG15c3FsX2Vyb3IoKSk7DQoJCQlpZiAobXlzcWxfZmV0Y2hfcm93KCRyZXN1bHQpKSB7DQoJCQkJZWNobyAiPHA+PGI+WW91ciBhbnN3ZXJzIGhhdmUgYWxyZWFkeSBiZWVuIHNhdmVkLCBpZ25vcmluZyBsYXN0IGlucHV0LjwvYj48L3A+IjsNCgkJCX0gZWxzZSB7DQoJCQkJZm9yZWFjaCgkX1BPU1QgYXMgJG5hbWUgPT4gJHZhbHVlKSB7DQoJCQkJCWlmICgkbmFtZSE9S0VZX0VYUEVSSU1FTlQgJiYNCgkJCQkJCSRuYW1lIT1LRVlfQ0FURUdPUlkgJiYNCgkJCQkJCSRuYW1lIT1LRVlfUVVFU1RJT04gJiYNCgkJCQkJCSRuYW1lIT1LRVlfU1VCSkVDVCAmJgkJCQkJDQoJCQkJCQkkbmFtZSE9S0VZX0VYUEVSSU1FTlRfQ09ERSAmJg0KCQkJCQkJJG5hbWUhPUtFWV9TVUJKRUNUX0NPREUgJiYNCgkJCQkJCSRuYW1lIT1LRVlfVElNRSAmJg0KCQkJCQkJJG5hbWUhPUtFWV9GT1JXQVJEKSB7DQoJCQkJCQkkYW5zd2Vyc1tdPSIoXCIkZXhwZXJpbWVudFwiLFwiJGNhdGVnb3J5XCIsXCIkcXVlc3Rpb25cIixcIiRzdWJqZWN0XCIsXCIkbmFtZVwiLFwiJHZhbHVlXCIpIjsNCgkJCQkJfQ0KCQkJCX0NCgkJCQkvL2luc2VydCBhbnN3ZXIgbm9kZQ0KCQkJCW15c3FsX3F1ZXJ5KCJJTlNFUlQgSU5UTyBhbnN3ZXJzIChleHBlcmltZW50LGNhdGVnb3J5LHF1ZXN0aW9uLHN1YmplY3QsdGltZSkgVkFMVUVTIChcIiRleHBlcmltZW50XCIsXCIkY2F0ZWdvcnlcIixcIiRxdWVzdGlvblwiLFwiJHN1YmplY3RcIixcIiR0aW1ldXNlZFwiKSIpDQoJCQkJCW9yIG15RW5kKCdDYW5ub3QgaW5zZXJ0IGFuc3dlciBub2RlOiAnIC4gbXlzcWxfZXJyb3IoKSk7DQoJCQkJLy9pbnNlcnQgYW5zd2VyIGF0dHJpYnV0ZXMNCgkJCQlpZiAoJGFuc3dlcnMpIHsNCgkJCQkJJHJlcXVlc3QgPSAiSU5TRVJUIElOVE8gYW5zd2Vyc19hdHRyaWJ1dGVzIChleHBlcmltZW50LCBjYXRlZ29yeSwgcXVlc3Rpb24sIHN1YmplY3QsIG5hbWUsIHZhbHVlKSBWQUxVRVMgIi4kYW5zd2Vyc1swXTsNCgkJCQkJJGkgPSAxOw0KCQkJCQl3aGlsZSAoJGFuc3dlcnNbJGldKSB7CQkJCQkJDQoJCQkJCQkkcmVxdWVzdCAuPSAiLCAiIC4gJGFuc3dlcnNbJGldOw0KCQkJCQkJJGkrKzsNCgkJCQkJfQ0KCQkJCQlteXNxbF9xdWVyeSgkcmVxdWVzdCkNCgkJCQkJCW9yIG15RW5kKCdDYW5ub3QgaW5zZXJ0IGFuc3dlciBhdHRyaWJ1dGVzOiAnIC4gbXlzcWxfZXJyb3IoKSk7DQoJCQkJfQ0KCQkJfQ0KCQkJLy9GaW5kIG5leHQgbm9kZQ0KCQkJLy9lY2hvICJERUJVRzogU2VhcmNoaW5nIG5leHQgbm9kZSI7DQoJCQkkbmV4dE5vZGVzID0gZ2V0TmV4dE5vZGVzKCRleHBlcmltZW50LCRjYXRlZ29yeSwkcXVlc3Rpb24pOw0KCQkJLy92YXJfZHVtcCgkbmV4dE5vZGVzKTsNCgkJCWlmICghJG5leHROb2Rlcykgew0KCQkJCS8vRW5kIHF1ZXN0aW9ubmFpcmUNCgkJCQllY2hvICJRdWVzdGlvbm5haXJlIGZpbmlzaGVkLiI7DQoJCQkJbXlFbmQoKTsNCgkJCX0NCgkJCSRuZXh0Tm9kZSA9ICRuZXh0Tm9kZXNbMF07DQoJCQkvL3Zhcl9kdW1wKCRuZXh0Tm9kZSk7DQoJCQlpZiAoISRuZXh0Tm9kZXNbMV0gb3IgJG5leHROb2Rlc1sxXVsnY2F0ZWdvcnknXT4kbmV4dE5vZGVbJ2NhdGVnb3J5J10pIHsNCgkJCQkvL2VjaG8gIkRFQlVHOiBOZXh0IG5vZGUgZW5kcyBjYXRlZ29yeSI7DQoJCQkJJGVuZHNDYXRlZ29yeT10cnVlOw0KCQkJfQ0KCQkJJGV4cGVyaW1lbnQ9JG5leHROb2RlWydleHBlcmltZW50J107DQoJCQkkY2F0ZWdvcnk9JG5leHROb2RlWydjYXRlZ29yeSddOw0KCQkJJHF1ZXN0aW9uPSRuZXh0Tm9kZVsncXVlc3Rpb24nXTsNCgkJCSRzaG93Tm9kZT0xOw0KCQl9DQoJfQkJDQoJaWYoJHNob3dOb2RlKSB7DQoJCS8vZWNobyAiREVCVUc6IE5leHQvdGhpcyBub2RlOiAkZXhwZXJpbWVudCwkY2F0ZWdvcnksJHF1ZXN0aW9uIjsNCgkJJHJlc3VsdCA9IG15c3FsX3F1ZXJ5KCJTRUxFQ1QgKiBGUk9NIG5vZGVzIFdIRVJFIGV4cGVyaW1lbnQ9XCIkZXhwZXJpbWVudFwiIEFORCBjYXRlZ29yeT1cIiRjYXRlZ29yeVwiIEFORCBxdWVzdGlvbj1cIiRxdWVzdGlvblwiIikNCgkJCW9yIG15RW5kKCdDYW5ub3QgcmV0cmlldmUgbm9kZTogJyAuIG15c3FsX2Vycm9yKCkpOw0KCQkkcmVzdWx0PW15c3FsX2ZldGNoX2FycmF5KCRyZXN1bHQpOw0KCQlpZiAoIXJlc3VsdCkgew0KCQkJbXlFbmQoJ05vZGUgbm90IGZvdW5kOiAkZXhwZXJpbWVudCwkY2F0ZWdvcnksJHF1ZXN0aW9uJyk7DQoJCX0NCgkJJG5hbWU9JHJlc3VsdFsnbmFtZSddOw0KCQkkdmFsdWU9JHJlc3VsdFsndmFsdWUnXTsNCgkJJHN0YXJ0c0V4cGVyaW1lbnQgPSAoJGNhdGVnb3J5PT0wICYmICRxdWVzdGlvbj09MCk7DQoJCS8vcmVtZW1iZXI6ICRlbmRzQ2F0ZWdvcnksICRzdWJqZWN0IChpZiBub3QgJHN0YXJ0c0V4cGVyaW1lbnQpDQoJCWVjaG8gIjxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgbmFtZT1cIiIuS0VZX1RJTUUuIlwiIHZhbHVlPVwiIi5taWNyb3RpbWUodHJ1ZSkuIlwiIC8+IjsNCgkJZWNobyAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiIi5LRVlfRVhQRVJJTUVOVC4iXCIgdmFsdWU9XCIkZXhwZXJpbWVudFwiIC8+IjsNCgkJZWNobyAiPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBuYW1lPVwiIi5LRVlfQ0FURUdPUlkuIlwiIHZhbHVlPVwiJGNhdGVnb3J5XCIgLz4iOw0KCQllY2hvICI8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCIiLktFWV9RVUVTVElPTi4iXCIgdmFsdWU9XCIkcXVlc3Rpb25cIiAvPiI7DQoJCWlmICgkY2F0ZWdvcnkhPTAgfHwgJHF1ZXN0aW9uIT0wKSB7DQoJCQllY2hvICI8aW5wdXQgdHlwZT1cImhpZGRlblwiIG5hbWU9XCIiLktFWV9TVUJKRUNULiJcIiB2YWx1ZT1cIiRzdWJqZWN0XCIgLz4iOw0KCQl9DQoJCWVjaG8gIjxoMT4kbmFtZTwvaDE+PGJyIC8+PGJyIC8+IjsNCgkJZWNobyAkdmFsdWU7DQoJCWVjaG8gSFRNTF9ESVZJREVSOw0KCQlpZiAoJHN0YXJ0c0V4cGVyaW1lbnQpIHsNCgkJCWVjaG8gRk9PVEVSX1NUQVJUX0VYUEVSSU1FTlQ7DQoJCX0gZWxzZSBpZiAoJGVuZHNDYXRlZ29yeSkgew0KCQkJZWNobyBGT09URVJfRU5EX0NBVEVHT1JZOw0KCQl9IGVsc2Ugew0KCQkJZWNobyBGT09URVJfRk9SV0FSRDsNCgkJfQ0KCQlteUVuZCgpOw0KCX0gZWxzZSB7CQkNCgkJLy9lY2hvICJERUJVRzogTm8gbm9kZSB0byBzaG93IjsNCgkJZWNobyAiRXhwZXJpbWVudC1Db2RlOjxiciAvPiI7DQoJCWVjaG8gIjxpbnB1dCBuYW1lPVwiIi5LRVlfRVhQRVJJTUVOVF9DT0RFLiJcIj48YnIgLz4iOw0KCQllY2hvICI8aW5wdXQgdHlwZT1cInN1Ym1pdFwiIHZhbHVlPVwiQWJzY2hpY2tlblwiIC8+IjsNCgkJbXlFbmQoKTsNCgl9DQo/Pg==";
    private static final String addexperiment =
            "PD9waHAKCXJlcXVpcmVfb25jZSgnY29uZmlnLnBocCcpOwoJcmVxdWlyZV9vbmNlKCdjb25zdGFudHMucGhwJyk7CQoJCgloZWFkZXIoIkNvbnRlbnQtVHlwZTogdGV4dC9odG1sOyBjaGFyc2V0PVVURi04Iik7CgoJZnVuY3Rpb24gbXlEaWUoJGN1cnJOb2RlLCAkZXJyb3IpIHsKCQkkZXhwZXJpbWVudCA9ICRjdXJyTm9kZVswXTsKCQlpZiAoJGV4cGVyaW1lbnQgIT0wKSB7CgkJCW15c3FsX3F1ZXJ5KCJERUxFVEUgRlJPTSBleHBlcmltZW50cyBXSEVSRSBleHBlcmltZW50PVwiJGV4cGVyaW1lbnRcIiIpOwoJCQlteXNxbF9xdWVyeSgiREVMRVRFIEZST00gbm9kZXMgV0hFUkUgZXhwZXJpbWVudD1cIiRleHBlcmltZW50XCIiKTsKCQkJbXlzcWxfcXVlcnkoIkRFTEVURSBGUk9NIG5vZGVzX2F0dHJpYnV0ZXMgV0hFUkUgZXhwZXJpbWVudD1cIiRleHBlcmltZW50XCIiKTsKCQl9CgkJZGllKCRlcnJvcik7Cgl9CglmdW5jdGlvbiBsb2FkTm9kZSgkbm9kZSwgJGN1cnJOb2RlLCAkbGV2ZWwgPSAwKSB7CgkJLy9jaGVjayBmb3IgY29uc2lzdGVuY3kKCQlpZiAoJGxldmVsPT0wKSB7CgkJCSRleHBlY3RlZD1OT0RFX0VYUEVSSU1FTlQ7CgkJfQoJCWlmICgkbGV2ZWw9PTEpIHsKCQkJJGV4cGVjdGVkPU5PREVfQ0FURUdPUlk7CgkJfQoJCWlmICgkbGV2ZWw9PTIpIHsKCQkJJGV4cGVjdGVkPU5PREVfUVVFU1RJT047CgkJfQoJCWlmICgkbGV2ZWw8MCB8fCAkbGV2ZWw+MikgewoJCQlteURpZSgkY3Vyck5vZGUsIldyb25nIGV4cGVyaW1lbnQgWE1MIGZvcm1hdC5cbkxldmVsOiAiLiRsZXZlbCk7CgkJfQkJCgkJaWYgKCRub2RlLT5nZXROYW1lKCkgIT09ICRleHBlY3RlZCkgewoJCQlteURpZSgkY3Vyck5vZGUsIldyb25nIGV4cGVyaW1lbnQgWE1MIGZvcm1hdC5cbkV4cGVjdGVkOiAiLiRleHBlY3RlZC4iXG5Gb3VuZDogIi4kbm9kZS0+Z2V0TmFtZSgpKTsKCQl9CgkJCgkJLy9ub2RlCgkJJG5hbWUgPSBteXNxbF9yZWFsX2VzY2FwZV9zdHJpbmcoJG5vZGVbS0VZX05BTUVdKTsKCQkkdmFsdWUgPSBteXNxbF9yZWFsX2VzY2FwZV9zdHJpbmcoJG5vZGVbS0VZX1ZBTFVFXSk7CgkJbXlzcWxfcXVlcnkoIklOU0VSVCBJTlRPIG5vZGVzIChleHBlcmltZW50LCBjYXRlZ29yeSwgcXVlc3Rpb24sIG5hbWUsIHZhbHVlKSBWQUxVRVMgKCciLiRjdXJyTm9kZVswXS4iJywgJyIuJGN1cnJOb2RlWzFdLiInLCAnIi4kY3Vyck5vZGVbMl0uIicsICckbmFtZScsICckdmFsdWUnKSIpCgkJCW9yIG15RGllKCRjdXJyTm9kZSwnQ2Fubm90IGluc2VydCBub2RlOiAnIC4gbXlzcWxfZXJyb3IoKSk7CgkJCgkJLy9hdHRyaWJ1dGVzCgkJaWYgKCRub2RlLT5hdHRyaWJ1dGVzWzBdLT5hdHRyaWJ1dGUpIHsKCQkJZm9yZWFjaCgkbm9kZS0+YXR0cmlidXRlc1swXS0+YXR0cmlidXRlIGFzICRhdHRyaWJ1dGUpIHsKCQkJCXN3aXRjaCgoc3RyaW5nKSRhdHRyaWJ1dGVbS0VZX05BTUVdKSB7CgkJCQkJY2FzZSBOQU1FX0RPTk9UU0hPV0NPTlRFTlQ6CgkJCQkJCWlmICghc3RyY21wKCRhdHRyaWJ1dGVbS0VZX1ZBTFVFXSxWQUxVRV9UUlVFKSkgewoJCQkJCQkJJGF0dHJpYnV0ZXNbXSA9ICIoJyIuJGN1cnJOb2RlWzBdLiInLCAnIi4kY3Vyck5vZGVbMV0uIicsICciLiRjdXJyTm9kZVsyXS4iJywgJyIuTkFNRV9ET05PVFNIT1dDT05URU5ULiInLCAnMScpIjsKCQkJCQkJfSBlbHNlIGlmICghc3RyY21wKCRhdHRyaWJ1dGVbS0VZX1ZBTFVFXSxWQUxVRV9GQUxTRSkpIHsKCQkJCQkJCSRhdHRyaWJ1dGVzW10gPSAiKCciLiRjdXJyTm9kZVswXS4iJywgJyIuJGN1cnJOb2RlWzFdLiInLCAnIi4kY3Vyck5vZGVbMl0uIicsICciLk5BTUVfRE9OT1RTSE9XQ09OVEVOVC4iJywgJzAnKSI7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSBOQU1FX0lOQUNUSVZFOgoJCQkJCQlpZiAoIXN0cmNtcCgkYXR0cmlidXRlW0tFWV9WQUxVRV0sVkFMVUVfVFJVRSkpIHsKCQkJCQkJCSRhdHRyaWJ1dGVzW10gPSAiKCciLiRjdXJyTm9kZVswXS4iJywgJyIuJGN1cnJOb2RlWzFdLiInLCAnIi4kY3Vyck5vZGVbMl0uIicsICciLk5BTUVfSU5BQ1RJVkUuIicsICcxJykiOwoJCQkJCQl9IGVsc2UgaWYgKCFzdHJjbXAoJGF0dHJpYnV0ZVtLRVlfVkFMVUVdLFZBTFVFX0ZBTFNFKSkgewoJCQkJCQkJJGF0dHJpYnV0ZXNbXSA9ICIoJyIuJGN1cnJOb2RlWzBdLiInLCAnIi4kY3Vyck5vZGVbMV0uIicsICciLiRjdXJyTm9kZVsyXS4iJywgJyIuTkFNRV9JTkFDVElWRS4iJywgJzAnKSI7CgkJCQkJCX0KCQkJCQkJYnJlYWs7CgkJCQkJY2FzZSBOQU1FX05PVEVTOgoJCQkJCQkkYXR0cmlidXRlc1tdID0gIignIi4kY3Vyck5vZGVbMF0uIicsICciLiRjdXJyTm9kZVsxXS4iJywgJyIuJGN1cnJOb2RlWzJdLiInLCAnIi5OQU1FX05PVEVTLiInLCAnIi5teXNxbF9yZWFsX2VzY2FwZV9zdHJpbmcoJGF0dHJpYnV0ZVtLRVlfVkFMVUVdKS4iJykiOwoJCQkJCQlicmVhazsKCQkJCX0KCQkJfQoJCX0KCQlpZiAoJGF0dHJpYnV0ZXMpIHsKCQkJJHJlcXVlc3QgPSAiSU5TRVJUIElOVE8gbm9kZXNfYXR0cmlidXRlcyAoZXhwZXJpbWVudCwgY2F0ZWdvcnksIHF1ZXN0aW9uLCBuYW1lLCB2YWx1ZSkgVkFMVUVTICIuJGF0dHJpYnV0ZXNbMF07CgkJCSRpID0gMTsKCQkJd2hpbGUgKCRhdHRyaWJ1dGVzWyRpXSkgewoJCQkJJHJlcXVlc3QgLj0gIiwgIiAuICRhdHRyaWJ1dGVzWyRpXTsKCQkJCSRpKys7CgkJCX0KCQkJbXlzcWxfcXVlcnkoJHJlcXVlc3QpCgkJCQlvciBteURpZSgkY3Vyck5vZGUsJ0Nhbm5vdCBpbnNlcnQgbm9kZSBhdHRyaWJ1dGVzOiAnIC4gbXlzcWxfZXJyb3IoKSk7CgkJfQoJCQoJCS8vY2hpbGRyZW4KCQlpZiAobGV2ZWw8MiAmJiAkbm9kZS0+Y2hpbGRyZW4pIHsKCQkJZm9yZWFjaCgkbm9kZS0+Y2hpbGRyZW4tPmNoaWxkcmVuKCkgYXMgJGNoaWxkKSB7CgkJCQkkY3Vyck5vZGVbJGxldmVsKzFdKys7CgkJCQlsb2FkTm9kZSgkY2hpbGQsICRjdXJyTm9kZSwgJGxldmVsKzEpOwoJCQl9CgkJfQoJfQoJCglpZiAoJF9SRVFVRVNUWyd4bWwnXSkgewoJCSR4bWwgPSAkX1JFUVVFU1RbJ3htbCddOwoJCWlmIChnZXRfbWFnaWNfcXVvdGVzX2dwYygpKSB7CgkJCSR4bWwgPSBzdHJpcHNsYXNoZXMoJHhtbCk7CgkJfQoJCSRleHBlcmltZW50ID0gc2ltcGxleG1sX2xvYWRfc3RyaW5nKCR4bWwpOwoJCWlmICghJGV4cGVyaW1lbnQpIHsKCQkJZWNobyAiZmFpbGVkIGxvYWRpbmcgWE1MXG4iOwoJCQlmb3JlYWNoKGxpYnhtbF9nZXRfZXJyb3JzKCkgYXMgJGVycm9yKSB7CgkJCQllY2hvICJcdCIsICRlcnJvci0+bWVzc2FnZTsKCQkJfQoJCQlkaWUoKTsKCQl9CgkJZm9yZWFjaCgkZXhwZXJpbWVudC0+YXR0cmlidXRlc1swXS0+YXR0cmlidXRlIGFzICRhdHRyaWJ1dGUpIHsKCQkJc3dpdGNoKChzdHJpbmcpJGF0dHJpYnV0ZVtLRVlfTkFNRV0pIHsKCQkJCWNhc2UgTkFNRV9DT0RFOgoJCQkJCSRjb2RlID0gJGF0dHJpYnV0ZVtLRVlfVkFMVUVdOwoJCQkJCWJyZWFrOwoJCQl9CgkJfQoJCWlmICgkY29kZSkgewoJCQlteXNxbF9xdWVyeSgiSU5TRVJUIElOVE8gZXhwZXJpbWVudHMgKGNvZGUpIFZBTFVFUyAoJyIubXlzcWxfcmVhbF9lc2NhcGVfc3RyaW5nKCRjb2RlKS4iJykiKQoJCQkJb3IgZGllKCdDcmVhdGluZyBleHBlcmltZW50IGZhaWxlZDogJyAuIG15c3FsX2Vycm9yKCkpOwoJCX0gZWxzZSB7CgkJCWRpZSgnRXhwZXJpbWVudCBjb2RlIG5vdCBmb3VuZCcpOwoJCX0KCQlsb2FkTm9kZSgkZXhwZXJpbWVudCwgYXJyYXkobXlzcWxfaW5zZXJ0X2lkKCksIDAsIDApKTsKCQllY2hvICJEb25lLiI7Cgl9IGVsc2Ugewo/Pgo8aHRtbD4KCTxoZWFkPgoJCTxtZXRhIGh0dHAtZXF1aXY9IkNvbnRlbnQtVHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PVVURi04IiAvPgoJPC9oZWFkPgoJPGJvZHk+CgkJPGZvcm0gbWV0aG9kPSJwb3N0IiBhY3Rpb249ImFkZGV4cGVyaW1lbnQucGhwIj4KCQkJWE1MOjxiciAvPgoJCQk8aW5wdXQgbmFtZT0ieG1sIj48YnIgLz4KCQkJPGlucHV0IHR5cGU9InN1Ym1pdCIgdmFsdWU9IkFic2NoaWNrZW4iIC8+CgkJPC9mb3JtPgoJPC9ib2R5Pgo8L2h0bWw+Cjw/CiB9Cj8+";
    private static final String constants =
            "PD9waHANCglkZWZpbmUoIktFWV9OQU1FIiwgIm5hbWUiKTsNCglkZWZpbmUoIktFWV9WQUxVRSIsICJ2YWx1ZSIpOw0KCWRlZmluZSgiTkFNRV9ET05PVFNIT1dDT05URU5UIiwgImRvbm90c2hvd2NvbnRlbnQiKTsNCglkZWZpbmUoIk5BTUVfSU5BQ1RJVkUiLCAiaW5hY3RpdmUiKTsNCglkZWZpbmUoIk5BTUVfUVVFU1RJT05TV0lUQ0hJTkciLCAicXVlc3Rpb25zd2l0Y2hpbmciKTsNCglkZWZpbmUoIk5BTUVfTk9URVMiLCAibm90ZXMiKTsNCglkZWZpbmUoIk5BTUVfQ09ERSIsICJleHBlcmltZW50Y29kZSIpOw0KCWRlZmluZSgiVkFMVUVfVFJVRSIsICJ0cnVlIik7DQoJZGVmaW5lKCJWQUxVRV9GQUxTRSIsICJmYWxzZSIpOw0KCWRlZmluZSgiTk9ERV9BVFRSSUJVVEVTIiwgImF0dHJpYnV0ZXMiKTsNCglkZWZpbmUoIk5PREVfQVRUUklCVVRFIiwgImF0dHJpYnV0ZSIpOw0KCWRlZmluZSgiTk9ERV9DSElMRFJFTiIsICJjaGlsZHJlbiIpOw0KCWRlZmluZSgiTk9ERV9FWFBFUklNRU5UIiwgImV4cGVyaW1lbnQiKTsNCglkZWZpbmUoIk5PREVfQ0FURUdPUlkiLCAiY2F0ZWdvcnkiKTsNCglkZWZpbmUoIk5PREVfUVVFU1RJT04iLCAicXVlc3Rpb24iKTsNCgkNCgkvL0hUTUwtS2V5cyAtIERPIE5PVCBVU0UgVEhFTSBBUyBOQU1FUyBGT1IgWU9VUg0KCWRlZmluZSgiS0VZX0ZPUldBUkQiLCAibmV4dFF1ZXN0aW9uIik7DQoJZGVmaW5lKCJLRVlfRVhQRVJJTUVOVF9DT0RFIiwgImV4cGVyaW1lbnRfY29kZSIpOw0KCWRlZmluZSgiS0VZX1NVQkpFQ1RfQ09ERSIsICJzdWJqZWN0X2NvZGUiKTsJDQoJZGVmaW5lKCJLRVlfU1VCSkVDVCIsICJzdWJqZWN0Iik7DQoJZGVmaW5lKCJLRVlfRVhQRVJJTUVOVCIsICJleHBlcmltZW50Iik7DQoJZGVmaW5lKCJLRVlfQ0FURUdPUlkiLCAiY2F0ZWdvcnkiKTsNCglkZWZpbmUoIktFWV9RVUVTVElPTiIsICJxdWVzdGlvbiIpOwkNCglkZWZpbmUoIktFWV9USU1FIiwgInRpbWUiKTsNCgkNCgkvL0hUTUwtUGxhY2Vob2xkZXINCglkZWZpbmUoIkhUTUxfU1RBUlQiLCAiPGh0bWw+PGhlYWQ+PG1ldGEgaHR0cC1lcXVpdj1cIkNvbnRlbnQtVHlwZVwiIGNvbnRlbnQ9XCJ0ZXh0L2h0bWw7IGNoYXJzZXQ9VVRGLThcIiAvPjwvaGVhZD48Ym9keT48Zm9ybSAgbWV0aG9kPVwicG9zdFwiIGFjdGlvbj1cImluZGV4LnBocFwiPiIpOw0KCWRlZmluZSgiSFRNTF9ESVZJREVSIiwgIjxiciAvPjxiciAvPjxociAvPjxiciAvPjxiciAvPiIpOw0KCWRlZmluZSgiRk9PVEVSX0ZPUldBUkRfQ0FQVElPTiIsICJXZWl0ZXIiKTsNCglkZWZpbmUoIkZPT1RFUl9FTkRfQ0FURUdPUllfQ0FQVElPTiIsICJLYXRlZ29yaWUgQWJzY2hsaWXDn2VuIik7DQoJZGVmaW5lKCJGT09URVJfU1RBUlRfRVhQRVJJTUVOVF9DQVBUSU9OIiwgIkV4cGVyaW1lbnQgc3RhcnRlbiIpOw0KCWRlZmluZSgiRk9PVEVSX0ZPUldBUkQiLCAiPGlucHV0IG5hbWUgPVwiIi5LRVlfRk9SV0FSRC4iXCIgdHlwZT1cInN1Ym1pdFwiIHZhbHVlPVwiIi5GT09URVJfRk9SV0FSRF9DQVBUSU9OLiJcIiAvPiIpOw0KCWRlZmluZSgiRk9PVEVSX0VORF9DQVRFR09SWSIsICI8aW5wdXQgbmFtZSA9XCIiLktFWV9GT1JXQVJELiJcIiB0eXBlPVwic3VibWl0XCIgdmFsdWU9XCIiLkZPT1RFUl9FTkRfQ0FURUdPUllfQ0FQVElPTi4iXCIgLz4iKTsNCglkZWZpbmUoIkZPT1RFUl9TVEFSVF9FWFBFUklNRU5UIiwgIjx0YWJsZT48dHI+PHRkPlByb2JhbmRlbmNvZGU6PC90ZD48dGQ+PGlucHV0IG5hbWU9XCIiLktFWV9TVUJKRUNUX0NPREUuIlwiIC8+PC90ZD48L3RyPjwvdGFibGU+Ii5IVE1MX0RJVklERVIuIjxpbnB1dCBuYW1lID1cIiIuS0VZX0ZPUldBUkQuIlwiIHR5cGU9XCJzdWJtaXRcIiB2YWx1ZT1cIiIuRk9PVEVSX1NUQVJUX0VYUEVSSU1FTlRfQ0FQVElPTi4iXCIgLz4iKTsNCglkZWZpbmUoIkhUTUxfRU5EIiwgIjwvZm9ybT48L2JvZHk+PC9odG1sPiIpOw0KPz4=";
    private static final String sql =
            "LS0gcGhwTXlBZG1pbiBTUUwgRHVtcAotLSB2ZXJzaW9uIDIuMTEuOC4xZGViNStsZW5ueTYKLS0gaHR0cDovL3d3dy5waHBteWFkbWluLm5ldAotLQotLSBIb3N0OiBsb2NhbGhvc3QKLS0gRXJzdGVsbHVuZ3N6ZWl0OiAxNC4gRGV6ZW1iZXIgMjAxMCB1bSAyMzo0NgotLSBTZXJ2ZXIgVmVyc2lvbjogNS4wLjUxCi0tIFBIUC1WZXJzaW9uOiA1LjIuNi0xK2xlbm55OQoKU0VUIFNRTF9NT0RFPSJOT19BVVRPX1ZBTFVFX09OX1pFUk8iOwoKCi8qITQwMTAxIFNFVCBAT0xEX0NIQVJBQ1RFUl9TRVRfQ0xJRU5UPUBAQ0hBUkFDVEVSX1NFVF9DTElFTlQgKi87Ci8qITQwMTAxIFNFVCBAT0xEX0NIQVJBQ1RFUl9TRVRfUkVTVUxUUz1AQENIQVJBQ1RFUl9TRVRfUkVTVUxUUyAqLzsKLyohNDAxMDEgU0VUIEBPTERfQ09MTEFUSU9OX0NPTk5FQ1RJT049QEBDT0xMQVRJT05fQ09OTkVDVElPTiAqLzsKLyohNDAxMDEgU0VUIE5BTUVTIHV0ZjggKi87CgotLQotLSBEYXRlbmJhbms6IGBtYXJrdXNfcXVlbGx0ZXh0cHJvamAKLS0KCi0tIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgotLQotLSBUYWJlbGxlbnN0cnVrdHVyIGbDvHIgVGFiZWxsZSBgYW5zd2Vyc2AKLS0KCkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGBhbnN3ZXJzYCAoCiAgYHN1YmplY3RgIGludCgxMSkgTk9UIE5VTEwsCiAgYG5vZGVgIGludCgxMSkgTk9UIE5VTEwsCiAgYGtleWAgdGV4dCBOT1QgTlVMTCwKICBgdmFsdWVgIHRleHQgTk9UIE5VTEwsCiAgUFJJTUFSWSBLRVkgIChgc3ViamVjdGAsYG5vZGVgKQopIEVOR0lORT1NeUlTQU0gREVGQVVMVCBDSEFSU0VUPXV0Zjg7CgotLSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLS0KLS0gVGFiZWxsZW5zdHJ1a3R1ciBmw7xyIFRhYmVsbGUgYGFuc3dlcnNfbWV0YWAKLS0KCkNSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGBhbnN3ZXJzX21ldGFgICgKICBgc3ViamVjdGAgaW50KDExKSBOT1QgTlVMTCwKICBgbm9kZWAgaW50KDExKSBOT1QgTlVMTCwKICBgdGltZWAgaW50KDExKSBOT1QgTlVMTCwKICBQUklNQVJZIEtFWSAgKGBzdWJqZWN0YCxgbm9kZWApCikgRU5HSU5FPU15SVNBTSBERUZBVUxUIENIQVJTRVQ9dXRmODsKCi0tIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgotLQotLSBUYWJlbGxlbnN0cnVrdHVyIGbDvHIgVGFiZWxsZSBgZXhwZXJpbWVudHNgCi0tCgpDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBgZXhwZXJpbWVudHNgICgKICBgaWRgIGludCgxMSkgTk9UIE5VTEwgYXV0b19pbmNyZW1lbnQsCiAgYGNvZGVgIHZhcmNoYXIoMjApIE5PVCBOVUxMLAogIGByb290X25vZGVgIGludCgxMSkgTk9UIE5VTEwsCiAgUFJJTUFSWSBLRVkgIChgaWRgKSwKICBLRVkgYGNvZGVgIChgY29kZWApCikgRU5HSU5FPU15SVNBTSBERUZBVUxUIENIQVJTRVQ9dXRmOCBBVVRPX0lOQ1JFTUVOVD0xIDsKCi0tIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgotLQotLSBUYWJlbGxlbnN0cnVrdHVyIGbDvHIgVGFiZWxsZSBgbm9kZXNgCi0tCgpDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBgbm9kZXNgICgKICBgaWRgIGludCgxMSkgTk9UIE5VTEwsCiAgYGV4cGVyaW1lbnRgIGludCgxMSkgTk9UIE5VTEwsCiAgYG5hbWVgIHZhcmNoYXIoMjApIE5PVCBOVUxMLAogIGBjb250ZW50YCB0ZXh0IE5PVCBOVUxMLAogIGBub3Rlc2AgdGV4dCBOT1QgTlVMTCwKICBgcHJldmlvdXNgIGludCgxMSkgTk9UIE5VTEwgZGVmYXVsdCAnLTEnLAogIGBuZXh0YCBpbnQoMTEpIE5PVCBOVUxMIGRlZmF1bHQgJy0xJywKICBQUklNQVJZIEtFWSAgKGBpZGApLAogIEtFWSBgZXhwZXJpbWVudGAgKGBleHBlcmltZW50YCkKKSBFTkdJTkU9TXlJU0FNIERFRkFVTFQgQ0hBUlNFVD11dGY4OwoKLS0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi0tCi0tIFRhYmVsbGVuc3RydWt0dXIgZsO8ciBUYWJlbGxlIGBzdWJqZWN0YAotLQoKQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgYHN1YmplY3RgICgKICBgaWRgIGludCgxMSkgTk9UIE5VTEwgYXV0b19pbmNyZW1lbnQsCiAgYGV4cGVyaW1lbnRgIGludCgyMCkgTk9UIE5VTEwsCiAgYGNvZGVgIHZhcmNoYXIoMjApIE5PVCBOVUxMLAogIFBSSU1BUlkgS0VZICAoYGlkYCksCiAgS0VZIGBleHBlcmltZW50YCAoYGV4cGVyaW1lbnRgLGBjb2RlYCkKKSBFTkdJTkU9TXlJU0FNIERFRkFVTFQgQ0hBUlNFVD11dGY4IEFVVE9fSU5DUkVNRU5UPTEgOwo=";

    public PHPExportComponent() {
        setBorder(BorderFactory.createTitledBorder(UIElementNames.PHP_PHP_EXPORT));
        setLayout(new VerticalLayout(5, VerticalLayout.LEFT, VerticalLayout.TOP));
        add(new JLabel(UIElementNames.PHP_HOST + ":"));
        final JTextField serverField = new JTextField("localhost", 20);
        add(serverField);
        add(new JLabel(UIElementNames.PHP_NAME_OF_DATABASE + ":"));
        final JTextField baseField = new JTextField(20);
        add(baseField);
        add(new JLabel(UIElementNames.PHP_USER_NAME + ":"));
        final JTextField userField = new JTextField(20);
        add(userField);
        add(new JLabel(UIElementNames.PHP_PASSWORD + ":"));
        final JPasswordField passField = new JPasswordField(20);
        add(passField);
        JButton exportButton = new JButton(UIElementNames.PHP_EXPORT_SCRIPT);
        add(exportButton);

        exportButton.addActionListener(new ActionListener() {

            private void writeToFile(String fileName, byte[] content) {
                try {
                    FileOutputStream out = new FileOutputStream(fileName);
                    out.write(content);
                    out.close();
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }

            @Override
            public void actionPerformed(ActionEvent arg0) {
                int confirm = JOptionPane
                        .showConfirmDialog(null, UIElementNames.PHP_DIALOG_UNENCRYPTED_PASSWORD_CONTINUE,
                                UIElementNames.PHP_DIALOG_TITLE_CONFIRM, JOptionPane.YES_NO_OPTION);
                if (confirm == JOptionPane.NO_OPTION) {
                    return;
                }
                String dirName = "." + System.getProperty("file.separator") + "phpExport";
                File dir = new File(dirName);
                int i = 1;
                while (dir.exists()) {
                    dir = new File(dirName + "_" + i);
                    i++;
                }
                dir.mkdirs();
                dirName = dir.getPath() + System.getProperty("file.separator");
                try {
                    writeToFile(dirName + "index.php", new BASE64Decoder().decodeBuffer(index));
                    writeToFile(dirName + "addexperiment.php", new BASE64Decoder().decodeBuffer(addexperiment));
                    writeToFile(dirName + "constants.php", new BASE64Decoder().decodeBuffer(constants));
                    writeToFile(dirName + "preparation.sql", new BASE64Decoder().decodeBuffer(sql));
                    String config = "<?php\n";
                    config += "	$db_server = '" + serverField.getText() + "';\n";
                    config += "	$db_base = '" + baseField.getText() + "';\n";
                    config += "	$db_user = '" + userField.getText() + "';\n";
                    config += "	$db_pass = '" + new String(passField.getPassword()) + "';\n";
                    config += "\n";
                    config += "//=================================================================\n";
                    config += "\n";
                    config += "	//libxml_use_internal_errors(true);\n";
                    config += "	mysql_connect($db_server, $db_user, $db_pass)\n";
                    config += "		or die('Connection to database failed: ' . mysql_error());\n";
                    config += "	mysql_select_db($db_base)\n";
                    config += "		or die('Selecting database failed: ' . mysql_error());\n";
                    config += "	?>";
                    writeToFile(dirName + "config.php", config.getBytes());
                    JOptionPane.showMessageDialog(null, UIElementNames.PHP_MESSAGE_EXPORT_FINISHED);
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        });
    }

    @Override
    public void setCaption(String caption) {
    }

    @Override
    public void loadValue() {
    }

    @Override
    public void saveValue() {
    }
}
